# Researcher Profile ‚Äî Saskatchewan Polytechnic (Post-Graduate Certificate in Data Analytics & AI)

**Name:** Anh Quan Bui  
**Email:** bui8334@saskpolytech.ca  
**Affiliation:** Saskatchewan Polytechnic ‚Äì School of ICT  
**Program:** Post-Graduate Certificate in Data Analytics & AI  
**Research Project:** *YouTube Video Virality Prediction Using Early Engagement Signals*  
**Summary:** This project investigates how early metrics (views, likes, comments) from YouTube Data API v3 can be used to predict the long-term popularity of videos. It combines data ingestion (via FastAPI and MongoDB) with machine learning modeling (XGBoost) to identify viral potential within the first 24 hours after upload.  
**Purpose:** To contribute an academic framework and prototype system supporting data-driven content marketing and social media analysis.

---

## üë• Team Members
- **Anh Quan Bui** ‚Äî [GitHub](https://github.com/anhquanbui) *(Lead Researcher / System Architect)*  
- **Eneyi Simeni** ‚Äî [GitHub](https://github.com/Eneyi1403) *(Data Engineer / Pipeline Development)*  
- **Nguyen Ha Dung** ‚Äî [GitHub](https://github.com/HaDung-Nguyen-000526332) *(Machine Learning & Model Evaluation)*  

---

# yt-autoscanner ‚Äî Local Dev (API + MongoDB + YouTube Worker + Scheduler)

A minimal starter to ingest **YouTube** videos into **MongoDB** and expose them via a **FastAPI** API.  
This README covers local development, environment config, the discover worker (v4.1), the tracker, backfill utilities, and the unified PowerShell runner.

> **Quick links**
> - API (local): `http://127.0.0.1:8000/docs`
> - Mongo (local): `mongodb://localhost:27017/ytscan`
> - Logs (local): `./logs/scanner-YYYYMMDD.log`

---

## üìò Docs Overview

| File | Description |
|------|--------------|
| [`mongo_collections_overview.md`](docs/mongo_collections_overview.md) | Explains all MongoDB collections and their key fields |
| [`pipeline_overview.md`](docs/pipeline_overview.md) | Describes end-to-end ingestion ‚Üí tracking ‚Üí processing pipeline |
| [`process_data_readme.md`](docs/process_data_readme.md) | Detailed documentation for `process_data.py` usage and logic |
| [`processed_videos_explanation.md`](docs/processed_videos_explanation.md) | Explains structure and meaning of `processed_videos.json` |

---

## What's new (Oct 20 2025)
- **Discover Worker v4.3** ‚Äî Added automatic filtering to skip live and upcoming videos.
- **Track Worker v3.1** ‚Äî Enhanced duration backfill logic for videos missing duration data.
- **Backfill Tool v1.0** ‚Äî Introduced `tools/backfill_missing_fields.py` to fill missing duration/handles independently.
- **.gitignore** ‚Äî Now excludes `.bak` backup files.

## What's new (Oct 17 2025)
- **Process Data Script (v1.0)** ‚Äî Automates inserting JSON into MongoDB.
- **Discover Worker (v4.2)** ‚Äî Adds duration enrichment and random region/query weighting.
- **Track Worker (v3.0)** ‚Äî Tracks video metrics at multiple milestones (up to 24h).
- **Unified Runner (v5)** ‚Äî Real-time logs and quota protection.

üëâ **View full changelog ‚Üí [CHANGELOG.md](CHANGELOG.md)**

---

## Project structure

```
YT-AUTOSCANNER/
‚îÇ
‚îú‚îÄ api/                           # FastAPI backend
‚îÇ   ‚îú‚îÄ main.py                    # API entry point (Uvicorn server)
‚îÇ   ‚îî‚îÄ requirements.txt           # API dependencies
‚îÇ
‚îú‚îÄ docs/                          # Internal documentation & references
‚îÇ   ‚îú‚îÄ Autorun_Scripts_Guide.md
‚îÇ   ‚îú‚îÄ mongo_collections_overview.md
‚îÇ   ‚îú‚îÄ pipeline_overview.md
‚îÇ   ‚îú‚îÄ process_data_readme.md
‚îÇ   ‚îî‚îÄ processed_videos_explanation.md
‚îÇ
‚îú‚îÄ logs/                          # Log output from workers / API
‚îÇ
‚îú‚îÄ tools/                         # Helper utilities
‚îÇ   ‚îú‚îÄ backfill_channels_v2.py
‚îÇ   ‚îú‚îÄ backfill_missing_fields.py
‚îÇ   ‚îî‚îÄ make_indexes.py
‚îÇ
‚îú‚îÄ worker/                        # Data ingestion and tracking logic
‚îÇ   ‚îú‚îÄ discover_once.py           # Discover new YouTube videos
‚îÇ   ‚îú‚îÄ track_once.py              # Track video stats over time (1h‚Üí24h)
‚îÇ   ‚îú‚îÄ scheduler.py               # Optional scheduler for periodic tasks
‚îÇ   ‚îú‚îÄ process_data.py            # Clean & aggregate raw data
‚îÇ   ‚îî‚îÄ requirements.txt           # Worker dependencies
‚îÇ
‚îú‚îÄ venv/                          # Local Python virtual environment (ignored by Git)
‚îÇ
‚îú‚îÄ .env                           # Environment variables (Mongo URI, API key, etc.)
‚îú‚îÄ .gitignore                     # Ignore venv, logs, cache files
‚îú‚îÄ requirements-dev.txt            # Full dev setup (worker + API + dashboard)
‚îú‚îÄ README.md                      # Documentation and setup instructions
‚îú‚îÄ CHANGELOG.md                   # Version changes and release notes
‚îú‚îÄ run_both_local.ps1             # Run discover + track together (PowerShell)
‚îú‚îÄ run_track_one_loop_30s.ps1     # Loop runner for track_once.py (demo/test)
‚îú‚îÄ auto-track.ps1                 # Auto-tracking shortcut script
‚îî‚îÄ seed.py                        # Seed data helper or test initialization

```

---

## API

### Endpoints
- `GET /health`
- `GET /videos`
- `GET /video/{id}`
- `GET /tracking`
- `GET /complete`
- `GET /videos/count`
- `GET /stats`
- *(future)* `/channels` for enriched channel info

---

## üß¨ Local Setup

### 1Ô∏è‚É£ Python & Virtual Environment (Windows PowerShell)

```powershell
# Create a new virtual environment
python -m venv venv

# If activation is blocked once:
#   Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned

# Activate the environment
.\venv\Scripts\Activate.ps1
```

---

### 2Ô∏è‚É£ Install Dependencies

You have two options depending on your workflow:

#### üß© Option A ‚Äî Install by module

```powershell
# API (FastAPI backend)
pip install -r api/requirements.txt

# Worker (discover_once.py, track_once.py)
pip install -r worker/requirements.txt

# Dashboard (Streamlit UI)
pip install -r dashboard/requirements.txt
```

#### üöÄ Option B ‚Äî Full development setup (everything)

```powershell
pip install -r requirements-dev.txt
```

> üí° **Tip:**  
> Use **Option B** for local development when you plan to run all components (API + worker + dashboard).  
> Use **Option A** for deploying or testing individual modules.

---

### 3Ô∏è‚É£ MongoDB Setup

```powershell
# Run MongoDB in Docker
docker run -d --name mongo -p 27017:27017 mongo:7

# (Optional) create indexes if you have a helper script
python tools/make_indexes.py
```

---

### 4Ô∏è‚É£ Run the FastAPI Backend

```powershell
cd api
uvicorn main:app --reload --host 0.0.0.0 --port 8000
# Swagger UI ‚Üí http://127.0.0.1:8000/docs
```

---

### 5Ô∏è‚É£ Run the Streamlit Dashboard (for future development)

```powershell
cd dashboard # dashboard PATH
streamlit run [name_of_the_file].py
# Default URL: http://localhost:8501
```

---

### 6Ô∏è‚É£ Run Worker Scripts (Data Ingestion / Tracking)

```powershell
# Discover new YouTube videos
python worker/discover_once.py

# Track video metrics over time (1h ‚Üí 24h)
python worker/track_once.py

# Optional: run both in a loop (PowerShell helper script)
.\run_both_local.ps1
```

---

### ‚öôÔ∏è Environment Variables (.env)

Ensure a `.env` file exists in the project root:

```env
# === MongoDB ===
MONGO_URI=mongodb://localhost:27017
DB_NAME=yt_autoscanner

# === YouTube API ===
YT_API_KEY=your_youtube_api_key_here
```

---

## Environment (`.env`)

```
# --- Required ---
YT_API_KEY=YOUR_YOUTUBE_API_KEY
MONGO_URI=mongodb://localhost:27017/ytscan

# --- Common ---
YT_REGION=US
YT_SINCE_MODE=minutes
YT_SINCE_MINUTES=20

# --- Random mode ---
YT_RANDOM_MODE=1
YT_RANDOM_REGION_POOL=US,GB,JP,VN,CA,SG,PH,IN,AU
YT_RANDOM_QUERY_POOL=live:5,news:3,gaming:4,highlights:4,music:3,trailer:3,shorts:3,breaking:2,review:2,concert:2,update:2

# --- Quota safety ---
YT_MAX_PAGES=2
DISCOVER_INTERVAL_SECONDS=1800   # 30min
TRACK_INTERVAL_SECONDS=30        # 30s
```

---

## Workers

### üîπ Discover Once
```powershell
python worker/discover_once.py
```
Discovers recent videos (within last 20 minutes).  
Saves `categoryId`, region, query, timestamp.  
Quota usage: ~101 units per 50 videos.

---

### üîπ Track Once
```powershell
python worker/track_once.py
```
Tracks stats per milestone ‚Üí snapshots every few minutes up to 24h.  
Quota: ~1 unit per 50 videos.

---

### üîπ Process Data
```powershell
python tools/process_data.py
```
Processes local JSON data and automatically inserts it into MongoDB.  
- Loads `.env` for default `MONGO_URI`.  
- Supports manual overrides via CLI args.  
- Pushes directly to MongoDB unless `--dry-run` specified.  

Example:
```powershell
python tools/process_data.py --mongo-uri "mongodb://localhost:27017" --db ytscan --collection videos
```

---

### üîπ Backfill Channels
```powershell
python tools/backfill_channels_v2.py --stale-hours 24
```
Refreshes missing or outdated channel stats.  
Dry-run mode:
```powershell
python tools/backfill_channels_v2.py --dry-run
```

---

## Unified Runner (PowerShell)

### Run both discover + tracker
```powershell
# If blocked once:
#   Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\run_both_local.ps1
```
- Loads `.env` automatically  
- Writes logs to `/logs/`  
- Auto-sleeps between runs  
- Stops safely on quota exhaustion

---

## Logging
- Logs are written to `logs/` with rotating daily filenames.  
- Each run includes timestamped activity from both workers.

**Tail logs live:**
```powershell
Get-Content .\logs\transcript-$(Get-Date -Format yyyyMMdd).log -Tail 100 -Wait
```

---

## Monitoring (MongoDB Compass)
Connect to:
```
mongodb://localhost:27017/ytscan
```
Collections:
- `videos` ‚Üí discovered & tracked videos
- `channels` ‚Üí enriched metadata & stats

Useful queries:
- `{ "tracking.status": "tracking" }`
- `{ "tracking.status": "complete" }`
- Sort by `snippet.publishedAt` or `tracking.discovered_at`

---

## Next steps
- Add ML model training for early-viral prediction using `stats_snapshots`.
- Implement FastAPI endpoints for `/channels` data.
- Add Docker Compose for full stack (API + MongoDB + Workers).

---

## üìä System Status Overview (as of 2025-10-17) (PROJECT TRACKING)

| Component | Description | Status | Completion |
|------------|--------------|:------:|:-----------:|
| **Core API** | FastAPI endpoints (`/videos`, `/health`, `/tracking`, etc.) | ‚úÖ Stable | **100%** |
| **MongoDB Integration** | Collections (`videos`, `channels`) with proper indexes | ‚úÖ Complete | **100%** |
| **Worker ‚Äî Discover** | Scans latest videos by region/query | ‚úÖ Functional | **100%** |
| **Worker ‚Äî Track** | Monitors statistics every milestone (up to 24h) | ‚úÖ Stable | **100%** |
| **Worker ‚Äî Process Data** | Processes JSON ‚Üí inserts into MongoDB automatically | ‚úÖ Complete | **100%** |
| **Worker ‚Äî Backfill Channels** | Updates channel metadata and stats | ‚úÖ Complete | **100%** |
| **Temporal Sampling Plan** | Refined to **64‚Äì65 timestamps / 24h** (dynamic frequency) | ‚úÖ Updated | **100%** |
| **Logging & Scheduler** | PowerShell unified runner (`run_both_local.ps1`) and log rotation | ‚úÖ Verified | **100%** |
| **Documentation (Docs + README)** | Unified formatting, consistent structure across all `.md` files | ‚úÖ Synced | **100%** |
| **Local Testing** | MongoDB + API + Worker integration tests | ‚öôÔ∏è Partial | **75%** |
| **Machine Learning Stage** | Feature extraction + XGBoost model training | üîú Pending | **20%** |
| **Visualization / Dashboard** | Optional analytics dashboard (Power BI / Streamlit) | üß© Planned | **15%** |

---

### üß† Summary
- **Core system (Ingestion + Tracking + Processing):** ‚úÖ **Complete (~85%)**  
- **Full project (including ML & Dashboard):** üöÄ **~65% overall progress**

> Next steps:
> 1. Implement ML model for early virality prediction.  
> 2. Add `/predict` and `/channels` endpoints in FastAPI.  
> 3. Build analytics dashboard for visualization and reporting.

---


üìÖ **Last updated:** 2025-10-20