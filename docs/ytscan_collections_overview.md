# MongoDB Collections Overview ‚Äî Database: `ytscan`

> This document describes all five main collections in the **ytscan** MongoDB database.  
> It focuses on the current **local mode**, showing schema, example documents, and intended use.

---

## 1Ô∏è‚É£ Collection: `videos` (CORE)

**Purpose:** Raw video-level data collected by `discover_once.py` and updated by `track_once.py`.

### Structure
```json
{
  "_id": "VIDEO_ID",
  "ml_flags": { /* optional model flags / heuristics */ },
  "source": {
    "query": "travel vlog japan",
    "regionCode": "JP",
    "randomMode": false,
    "channelHandle": "@travelerA"
  },
  "snippet": {
    "title": "My 24 Hours in Tokyo",
    "publishedAt": "2025-10-17T03:25:00Z",
    "channelId": "UC1234...",
    "channelTitle": "Traveler A",
    "channelHandle": "@travelerA",
    "categoryId": "22",
    "durationISO": "PT21S",
    "durationSec": 21,
    "lengthBucket": "short"
  },
  "tracking": {
    "status": "complete",
    "discovered_at": "2025-10-17T03:25:00Z",
    "last_polled_at": "2025-10-17T23:20:00Z",
    "poll_count": 78,
    "stop_reason": null
  },
  "stats_snapshots": [
    { "ts": "2025-10-17T03:30:00Z", "viewCount": 1200, "likeCount": 70, "commentCount": 4 },
    { "ts": "2025-10-17T03:45:00Z", "viewCount": 1800, "likeCount": 90, "commentCount": 6 }
  ]
}
```

**Notes:**
- Each document = one tracked video (`_id` is the YouTube video ID).  
- `stats_snapshots` holds all time-series points; `track_once.py` appends until `tracking.status = "complete"`.  
- Fields like `durationISO`, `durationSec`, `lengthBucket`, and `channelHandle` help classify Shorts/long-form and join with channels.  
- `ml_flags` reserved for downstream tagging.  

---

## 2Ô∏è‚É£ Collection: `processed_videos` (CORE)

**Purpose:** Detailed post-processed data for analytics & machine learning.  
**Generated by:** `process_data.py` (v6) ‚Äî with fixed horizons and coverage.

### Structure
```json
{
  "video_id": "abcd1234",
  "status": "complete",
  "published_at": "2025-10-17T03:25:00Z",
  "n_snapshots": 78,
  "last_snapshot_ts": "2025-10-17T23:20:00Z",
  "completed_horizons": [60, 180, 360, 720, 1440],
  "n_completed_horizons": 5,
  "horizons": {
    "60":   { "views": 1200, "likes": 70, "comments": 4, "value_method": "floor", "coverage_ratio": 0.62, "n_expected": 12, "n_available": 8 },
    "180":  { "views": 4200, "likes": 190, "comments": 21, "value_method": "floor", "coverage_ratio": 0.60, "n_expected": 28, "n_available": 17 },
    "360":  { "views": 9200, "likes": 440, "comments": 48, "value_method": "ceil", "coverage_ratio": 0.51, "n_expected": 44, "n_available": 22 },
    "720":  { "views": 22000, "likes": 900, "comments": 120, "value_method": "floor", "coverage_ratio": 0.80, "n_expected": 52, "n_available": 42 },
    "1440": { "views": 56000, "likes": 2300, "comments": 380, "value_method": "floor", "coverage_ratio": 0.92, "n_expected": 64, "n_available": 59 }
  }
}
```

**Notes:**
- One row per video; aggregated across fixed horizons: **1h, 3h, 6h, 12h, 24h**.  
- `value_method`: `"floor"` = last snapshot **at or before** the horizon; `"ceil"` = first snapshot **after** the horizon (‚â§30m tolerance).  
- `coverage_ratio` = availability ratio under the defined sampling plan (5m‚Äì15m‚Äì30m‚Äì60m).  
- Arrays `completed_horizons` + `n_completed_horizons` speed up filtering in dashboards/ML.  

---

## 3Ô∏è‚É£ Collection: `dashboard_summary` (SUPPORTING)

**Purpose:** Lightweight dataset for dashboards and monitoring.  
**Generated by:** `process_data.py` (v6)

### Structure
```json
{
  "video_id": "abcd1234",
  "status": "complete",
  "published_at": "2025-10-17T03:25:00Z",
  "n_snapshots": 78,
  "last_snapshot_ts": "2025-10-17T23:20:00Z",
  "reached_h1": true,
  "reached_h3": true,
  "reached_h6": true,
  "reached_h12": true,
  "reached_h24": true,
  "coverage_1h": 0.62,
  "coverage_3h": 0.60,
  "coverage_6h": 0.51,
  "coverage_12h": 0.80,
  "coverage_24h": 0.92,
  "n_completed_horizons": 5
}
```

**Notes:**
- Minimal fields for BI tools (Power BI / Streamlit).  
- Booleans `reached_h*` show whether a valid value exists at each horizon.  
- Always re-synced after every `process_data.py` run.  

---

## 4Ô∏è‚É£ Collection: `channels` (SUPPORTING)

**Purpose:** YouTube channel metadata for enrichment and context.  
**Populated by:** `discover_once.py` or a dedicated channel sync script.

### Structure
```json
{
  "_id": "UC1234...",
  "snippet": {
    "title": "Traveler A",
    "publishedAt": "2018-03-12T00:00:00Z",
    "country": "JP"
  },
  "stats": {
    "subscriberCount": 142000,
    "videoCount": 210,
    "viewCount": 9800000
  },
  "last_synced_at": "2025-10-17T10:00:00Z"
}
```

**Notes:**
- One document per channel (`_id` is the channel ID).  
- Join with `videos.snippet.channelId` or `snippet.channelHandle`.  

---

## 5Ô∏è‚É£ File: `dashboard_overview.json` (SUPPORTING FILE)

**Purpose:** Single-file overview for ops dashboards (total vs processed vs pending).  
**Generated by:** `process_data.py` (v6)

### Structure
```json
{
  "total_videos": 2017,
  "processed_videos": 1980,
  "pending_videos": 37,
  "timestamp": "2025-10-20T18:55:12Z"
}
```

**Notes:**
- Counts derived directly from MongoDB (`videos`, `processed_videos`).  
- Written to **project root or `--out-dir`** depending on environment.  

---

## ‚úÖ Summary Overview

| Collection / File           | Source            | Type        | Key Field      | Description                                       |
|----------------------------|-------------------|-------------|----------------|---------------------------------------------------|
| `videos`                   | Discover + Track  | Timeseries  | `_id`          | Raw API snapshots + snippet/source/tracking       |
| `processed_videos`         | Process script    | Aggregated  | `video_id`     | Horizon metrics + coverage + completion flags     |
| `dashboard_summary`        | Process script    | Dashboard   | `video_id`     | Simplified stats for visualization                |
| `channels`                 | Discover/Sync     | Metadata    | `_id`          | Channel metadata and aggregate stats              |
| `dashboard_overview.json`  | Process script    | File (JSON) | ‚Äî              | Global counters for total/processed/pending       |

---

üìÖ **Last Updated:** **Oct 20 2025**
