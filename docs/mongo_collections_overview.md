# MongoDB Collections Overview ‚Äî Database: `ytscan`

> This document describes all four main collections in the **ytscan** MongoDB database.  
> It focuses on the current **local mode**, showing schema, example documents, and intended use.

---

## 1Ô∏è‚É£ Collection: `videos` (CORE)

**Purpose:** Raw video-level data collected by `discover_once.py` and updated by `track_once.py`.

### Structure
```json
{
  "_id": "VIDEO_ID",
  "source": {
    "query": "travel vlog japan",
    "regionCode": "JP",
    "randomMode": false
  },
  "snippet": {
    "title": "My 24 Hours in Tokyo",
    "publishedAt": "2025-10-17T03:25:00Z",
    "channelId": "UC1234...",
    "channelTitle": "Traveler A",
    "categoryId": "22"
  },
  "tracking": {
    "status": "complete",
    "discovered_at": "2025-10-17T03:25:00Z",
    "last_polled_at": "2025-10-17T23:20:00Z",
    "poll_count": 78,
    "stop_reason": null
  },
  "stats_snapshots": [
    { "ts": "2025-10-17T03:30:00Z", "viewCount": 1200, "likeCount": 70, "commentCount": 4 },
    { "ts": "2025-10-17T03:45:00Z", "viewCount": 1800, "likeCount": 90, "commentCount": 6 }
  ]
}
```

**Notes:**
- Each document = one tracked video.  
- `stats_snapshots` contains all time-series data points collected via YouTube API.  
- The record is appended until `tracking.status = "complete"`.

---

## 2Ô∏è‚É£ Collection: `processed_videos` (CORE)

**Purpose:** Detailed post-processed data for analytics & machine learning.  
**Generated by:** `process_data.py`

### Structure
```json
{
  "video_id": "abcd1234",
  "status": "complete",
  "published_at": "2025-10-17T03:25:00Z",
  "n_snapshots": 78,
  "last_snapshot_ts": "2025-10-17T23:20:00Z",
  "horizons": {
    "60":   { "views": 1200, "likes": 70,  "comments": 4,  "value_method": "floor", "coverage_ratio": 0.62, "n_expected": 12, "n_available": 8 },
    "180":  { "views": 4200, "likes": 190, "comments": 21, "value_method": "floor", "coverage_ratio": 0.60, "n_expected": 28, "n_available": 17 },
    "360":  { "views": 9200, "likes": 440, "comments": 48, "value_method": "ceil",  "coverage_ratio": 0.51, "n_expected": 44, "n_available": 22 },
    "1440": { "views": 56000,"likes": 2300,"comments": 380,"value_method": "floor", "coverage_ratio": 0.92, "n_expected": 64, "n_available": 59 }
  }
}
```

**Notes:**
- One row per video (aggregated).  
- Stores metrics across key horizons: 1h, 3h, 6h, 24h.  
- `"value_method"` = `floor` or `ceil` depending on how close the data was captured relative to horizon time.  
- Coverage values show data completeness.  

---

## 3Ô∏è‚É£ Collection: `dashboard_summary` (SUPPORTING)

**Purpose:** Lightweight dataset for dashboards and monitoring.  
**Generated by:** `process_data.py`

### Structure
```json
{
  "video_id": "abcd1234",
  "status": "complete",
  "published_at": "2025-10-17T03:25:00Z",
  "n_snapshots": 78,
  "last_snapshot_ts": "2025-10-17T23:20:00Z",
  "reached_h1": true,
  "reached_h3": true,
  "reached_h6": true,
  "reached_h24": true,
  "coverage_1h": 0.62,
  "coverage_3h": 0.60,
  "coverage_6h": 0.51,
  "coverage_24h": 0.92
}
```

**Notes:**
- Minimal version of `processed_videos` for dashboards (Power BI / Streamlit).  
- Contains boolean reach flags and numeric coverage summaries.  
- Always synchronized after `process_data.py` execution.  

---

## 4Ô∏è‚É£ Collection: `channels` (SUPPORTING)

**Purpose:** YouTube channel metadata for enrichment and context.  
**Populated by:** `discover_once.py` or a dedicated channel sync script.

### Structure
```json
{
  "_id": "UC1234...",
  "snippet": {
    "title": "Traveler A",
    "publishedAt": "2018-03-12T00:00:00Z",
    "country": "JP"
  },
  "stats": {
    "subscriberCount": 142000,
    "videoCount": 210,
    "viewCount": 9800000
  },
  "last_synced_at": "2025-10-17T10:00:00Z"
}
```

**Notes:**
- Each document represents one YouTube channel.  
- Used mainly to join with video-level data for richer analysis.

---

## ‚úÖ Summary Overview

| Collection | Source | Data Type | Key Field | Description |
|-------------|----------|------------|------------|--------------|
| `videos` | Discover + Track | Timeseries | `_id` (video_id) | Raw snapshots from API |
| `processed_videos` | Process script | Aggregated | `video_id` | Summarized metrics at fixed horizons |
| `dashboard_summary` | Process script | Dashboard | `video_id` | Simplified stats for visualization |
| `channels` | Discover | Metadata | `_id` (channel_id) | Channel-level metadata and stats |

---

üìÖ **Last Updated:** 2025-10-17
